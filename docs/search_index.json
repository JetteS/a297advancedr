[["good-practices.html", "Chapter 2 Good practices 2.1 Coding style 2.2 RStudio 2.3 Version control (Git) 2.4 Getting help Useful resources", " Chapter 2 Good practices In the following, we will consider some good practices for writing R code. But before we dive into that topic, let us explain why code needs to be clean and efficient. First, if you are working in a team, writing efficient and clean code makes it a lot easier for you colleagues to understand, debug and improve it. If you want your colleagues or collaborators to reuse your code, it should be readable and easy to follow. Second, you can spare your future self a lot of frustration by writing clean code from the beginning. By doing that, you won’t have to ask yourself What the hell am I doing in this function? 2.1 Coding style Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread. — Hadley Wickham Please make your code readable by following the available style guides. We recommend you take a look at the tidyverse style guide. In the following, we provide some examples from this guide. 2.1.1 Naming Be smart with your naming. You won’t believe how often we have seen df &lt;- as.matrix(mtcars) on Stack Overflow. Use meaningful and concise names for you files, data sets, and functions; you will save yourself a lot of time. For example, consider the following piece of code dat1 &lt;- tidytuesdayR::tt_load(&quot;2020-01-14&quot;)[[1]] dat2 &lt;- dat1[dat1$category == &quot;animal&quot;,] dat3 &lt;- dat1[dat1$strength == 7,] fct1 &lt;- function(tbl, n = 5) { tbl &lt;- tbl[complete.cases(tbl$rank),] tbl[tbl$rank &lt;= n, 2] } Looking only at this code, do you have any idea what data is stored in dat1, dat2 and dat3? Not really, right? Now imagine, you have 500 lines of code analyzing and visualizing the three different data sets using numerous functions. You would probably get confused about the different data sets and functions quite quick. Now consider the following lines of code passwords &lt;- tidytuesdayR::tt_load(&quot;2020-01-14&quot;)[[1]] password_category &lt;- passwords[passwords$category == &quot;animal&quot;,] password_strength &lt;- passwords[passwords$strength == 7,] get_popular_passwords &lt;- function(tbl, n = 5) { tbl &lt;- tbl[complete.cases(tbl$rank),] tbl[tbl$rank &lt;= n, 2] } This code is identical to the previous code; except for the names. But it is much easier to read and understand. Let us improve the code even more by adding comments. # Loading the passwords data passwords &lt;- tidytuesdayR::tt_load(&quot;2020-01-14&quot;)[[1]] # Extracting passwords within the category &quot;animal&quot; password_category &lt;- passwords[passwords$category == &quot;animal&quot;,] # Extracting passwords with a quality of 7 password_strength &lt;- passwords[passwords$strength == 7,] # Function: extracts the n most popular passwords get_popular_passwords &lt;- function(tbl, n = 5) { tbl &lt;- tbl[complete.cases(tbl$rank),] tbl[tbl$rank &lt;= n, 2] } When commenting code, you should focus on explaining the “why” instead of the “what” or “how”. Comments should be in sentence case, and only end with a full stop if they contain at least two sentences. Suggestions for naming: For files names, use underscore separated strings. All words should be lower case, e.g. fit_models.R or utility_functions.R (with consideration for operating systems with a case-sensitive file systems). Never have file names that only differ in their capitalization! Avoid using special characters in file names. For function names, use only lowercase letters and numbers separated by an underscore (_), e.g. compute_mean. Avoid using dots in function names, as they should be reserved exclusively for the S3 object system. Generally, function names should be verbs. For variable names, use only lowercase letters and numbers separated by an underscore (_), e.g. day_1. Avoid re-using names of common functions and variables (such as mean, c or T), as this may cause confusion for the readers. Generally, variable names should be nouns. 2.1.2 Spacing Place a space before and after = when naming arguments in function calls. Most infix operators (==, +, -, &lt;-, etc.) are also surrounded by spaces, except those with high precedence (^, :, ::, and :::, $, [, [[), !! (bang-bang) and !!! (bang-bang-bang) when used in tidy evaluation, the help operator ?. # Good average &lt;- mean((feet / 12) + inches, na.rm = TRUE) x &lt;- 1:10 base::sum ?mean # Unfortunate average&lt;-mean(feet/12+inches,na.rm=TRUE) x &lt;- 1 : 10 base :: sum ? mean Always put a space after a comma, and never before (just like in regular English). # Good x[, 1] # Unfortunate x[,1] x[ ,1] x[ , 1] For parenthesis, there are three different rules. When parentheses are used in connection to regular function calls, they are not surround by space: # Good mean(x, na.rm = TRUE) # Unfortunate mean (x, na.rm = TRUE) mean( x, na.rm = TRUE ) However, when the parentheses are used with if, for, or while, they are surrounded by space: # Good if (debug) { show(x) } # Unfortunate if(debug){ show(x) } When the parentheses are used for function arguments, you put a space after the closing parenthesis ): # Good function(x) {} # Unfortunate function (x) {} function(x){} Finally, the pipe %&gt;% should always have a space before it, and it is usually followed by a new line. # Good iris %&gt;% group_by(Species) %&gt;% summarize_if(is.numeric, mean) %&gt;% ungroup() %&gt;% gather(measure, value, -Species) %&gt;% arrange(value) # Unfortunate iris %&gt;% group_by(Species) %&gt;% summarize_all(mean) %&gt;% ungroup %&gt;% gather(measure, value, -Species) %&gt;% arrange(value) We will return to the pipe operator in Chapter 4. The same styling suggestions also hold for the operator that separates ggplot2 layers, +. You will meet this operator again in Chapter 4. 2.1.3 Indenting Curly braces, {}, define the most important hierarchy of R code. To make this hierarchy easy to see, always indent the code inside {} by two spaces. This should be automatic in RStudio. # Good if (y &lt; 0 &amp;&amp; debug) { message(&quot;y is negative&quot;) } if (y == 0) { if (x &gt; 0) { log(x) } else { message(&quot;x is negative or zero&quot;) } } else { y ^ x } # Unfortunate if (y &lt; 0 &amp;&amp; debug) message(&quot;Y is negative&quot;) if (y == 0) { if (x &gt; 0) { log(x) } else { message(&quot;x is negative or zero&quot;) } } else { y ^ x } 2.1.4 Long lines Strive to limit your code to 80 characters per line. This fits comfortably on your screen with a reasonably sized font. If you find yourself running out of room, this is a good indication that you should encapsulate some of the work in a separate function. To change the margin in RStudio go to Tools -&gt; Global Options -&gt; Code -&gt; Display, and set Margin column: to 80. Your browser does not support the video tag. 2.1.5 Other Use &lt;-, not =, for assignment. Keep = for parameters. # Good x &lt;- 5 system.time( x &lt;- rnorm(1e6) ) # Unfortunate x = 5 system.time( x = rnorm(1e6) ) Don’t end a line of code with ;, and avoid multiple commands on the same line. Only use return() for early returns. Otherwise rely on R to return the result of the last evaluated expression. Moreover, return statements should always be on their own line. # Good add_two &lt;- function(x, y) { x + y } # Unfortunate add_two &lt;- function(x, y) { return(x + y) } Use \", not ', for quoting text. The only exception is when the text already contains double quotes and no single quotes. # Good &quot;Text&quot; &#39;Text with &quot;quotes&quot;&#39; &#39;&lt;a href=&quot;http://style.tidyverse.org&quot;&gt;A link&lt;/a&gt;&#39; # Unfortunate &#39;Text&#39; &#39;Text with &quot;double&quot; and \\&#39;single\\&#39; quotes&#39; Use TRUE and FALSE instead of T and F. 2.1.6 Code organization The way the code is organized within a single file significantly impacts the readability. We suggest to start each file with a comment holding a description of the file, who wrote it, and when it was last updated. You may want to set a default template that is used each time you open a new .R script. To do this, you have to create a templates folder in AppData/Roaming/RStudio/ and include a default.R file with the desired template. # Create a template folder fs::dir_create(path = &quot;~/AppData/Roaming/RStudio/templates&quot;) # Create the file fs::file_create(path = &quot;~/AppData/Roaming/RStudio/templates/default.R&quot;) # Open the file in RStudio usethis::edit_file(&quot;~/AppData/Roaming/RStudio/templates/default.R&quot;) For example, you can add the following comments to default.R: ###################################################################### ## Title : ## ## Description : ## ## Author : ## ## Date : ###################################################################### ## ## Loading required libraries:######################################## Remember to save the changes you made to default.R. After the comment section, you should load all required add-on packages using library(). This is more transparent than having many library() calls throughout your entire code. Afterwards, any required files should be sourced using source(). Again, this is more transparent than having many source() calls throughout your entire code. Finally, you can start your code. Within your code, use commented lines of -, = or # to break up your file into smaller bits. 2.1.7 Styler You can use the package styler to correct your style. It even has RStudio Addins. Once you have installed the package using install.packages(\"styler\"), you can format your code according to the tidyverse style guide (or your custom style guide) through the RStudio addin as demonstrated below, or through R functions like style_text(), style_file() or style_pkg(). In RStudio, you can also use the shortcut Ctrl+Shift+A (Windows and Linux) or Shift+Command+A (Mac) to reformat selected code. We will talk about RStudio shortcuts in the next section (2.2). 2.2 RStudio Download a recent enough version of the RStudio IDE (see Prerequisites in Chapter 1 for details). These materials are based on RStudio version 2024.04.2, and we recommend that you use that or any newer version. Once you have installed RStudio, use it! RStudio comes with many tools and features, for example everything you can expect from a good integrated development environment (IDE) useful keyboard shortcuts. We often use the following shortcuts (Windows or Linux / Mac) Ctrl+Space / Command+Space for auto-completion (better than Tab) Ctrl+Up / Command+Up to show and search the command history in a popup Ctrl+Click / Command+Click to see a function’s source code Ctrl+Enter / Command+Return to execute current line/selection of code Ctrl+Shift+A / Shift+Command+A to reformat current selection of code Ctrl+Shift+C / Shift+Command+C to comment/uncomment selected lines Ctrl+Shift+K / Shift+Command+K to knit a document (you will need this in Chapter 4) Ctrl+Shift+B / Shift+Command+B to build a package, website or book (you will learn how to build a package in Chapter 6) Ctrl+Shift+M / Shift+Command+M to insert the pipe operator (we use this shortcut all of the time when working in the tidyverse!) Alt+Shift+K / Option+Shift+K to see more keyboard shortcuts. You can find all keyboard shortcuts by using the keyboard shortcut Alt+Shift+K / Option+Shift+K and click on See All Shortcuts in the upper right corner of the window. You can also find them under the Tools menu Tools -&gt; Keyboard Shortcuts Help -&gt; See All Shortcuts, or you can go to this Posit Support website. Finally, you can also change keyboard shortcuts under the Tools menu Tools -&gt; Modify Keyboard Shortcuts. panels (everything is integrated, including Git and a terminal). You can also change the appearance, pane layout, and more under the Tools menu Tools -&gt; Global Options... -&gt; Appearance/Pane Layout interactive data importation from files and connections (see this webinar): code diagnostics can be enabled and options can be set within the Tools -&gt; Global Options -&gt; Code -&gt; Diagnostics editing pane. When code diagnostics are enabled, RStudio performs static and dynamic analysis of your R code and warns you when it detects problems. RStudio reports any errors or warnings in the left gutter (next to the line number) by a marker and by underlining the position in the code. When you mouse over the marker, a popup with a short explanation will appear. Another very useful feature of the RStudio IDE is that it includes RStudio projects. RStudio projects make it straightforward to divide your work into multiple contexts, and keep all files associated with a single project together - input data, R scripts, analytic results, figures, etc. The reason why we advise you to work in RStudio projects is that it doesn’t rely on absolute file paths (in contrast to setting your working directory using setwd()). The chance of setwd() working for anyone besides its author is basically 0 %. And having to hand edit one or more paths every time you take over a project can be extremely annoying. RStudio projects solve this issue by making file paths relative. When your RStudio session is running through an RStudio project file (.Rproj), the current working directory points to the root folder where that .Rproj file is saved. In short, the benefits of using RStudio projects are a meaningful structure in one folder the working directory automatically switches to the project’s folder the last previously open file is loaded into the Source pane the History tab in the Environment pane displays R commands executed in previous sessions. the Files tab in the Files pane displays the associated files and folders in the project any settings associated with the project, such as Git settings, are loaded. Note that you can have a .Rprofile file in the project’s root directory to enable project-specific settings to be loaded each time someone opens the project. You can read more about RStudio projects in Chapter 8 of R for Data Science by Hadley Wickham and Garrett Grolemund, in this Tidyverse blog post, and also in Section 2.5 RStudio of Efficient R programming by Colin Gillespie and Robin Lovelace. 2.3 Version control (Git) A useful feature of RStudio projects is that it enables you to use formal version control. Version control is an important process to back up files, keep track of changes, and simplify collaborations. RStudio currently supports two open source version control systems: Git and Subversion. In these materials, we will focus on Git as a version control system, and we will hook our local repositories up to a remote host, namely GitHub. You can find more information about how to activate Git on your system in Section Prerequisites of Chapter 1. 2.3.1 Why use Git? Have you ever Made changes to code, realized it was a mistake and wanted to revert back? Lost code or had a backup that was too old? Wanted to submit a change to someone’s code? Wanted to share your code, or let other people work on your code? Or are you a PhD student working on a manuscript? But you don’t use Git? Figure 2.1: You don’t use Version Control? In these cases, and probably many others, a version control system should make your life easier (see https://stackoverflow.com/a/1408464/6103040). Version control for the data analyst: reproducible workflow Also, see https://stackoverflow.com/q/2712421/6103040. Use version control to work from anywhere Working with GitHub can be a line on your CV (read more): A lot of students have said to me later, even first-year undergraduates, that using GitHub has helped them a lot when they went for an internship or a research position interview. They are able to say, “Oh, I already have worked with GitHub. I am familiar with it. I know how it works.” So I think they are at least able to put that on their CV and go into a situation where there’s a research or data analysis team and say, “Yeah, sure. I am actually familiar with the same tools that you use.” – Mine Cetinkaya-Rundel, Duke University, RStudio Be able to get websites for your packages with pkgdown, for your book (like this one!) with bookdown, for your personal webpage with R Markdown Websites or blogdown. 2.3.2 About Git Main Git platforms (share your code, collaborate): GitHub, documentation (only free for public repositories, now owned by Microsoft) GitLab (open source &amp; free) Bitbucket (free when you have less than 5 collaborators) any server.. 4 main commands: add: add files to be part of the next commit commit: snapshot of your code at a specified point in time (you can and you should use this even when having no internet connection) push: merge your local modifications with the main project pull: update your local project with the latest version of the main project Simple (solo) use of git to prevent merge conflicts: after opening a project, always pull before closing a project, always commit/push Use git even when you do not have any internet connection! (e.g. on a secure server) Just use commits for version control locally. How to link between an RStudio project and a GitHub repository? For Mac users, you might need to use the terminal for git clone, then create the RStudio project from the existing directory. If you have some permission denied for the public key, you might also need to run ssh-agent -s &amp;&amp; ssh-add &lt;path_to_public_key&gt; (cf. this SO answer). Help with Git: Happy Git and GitHub for the useR Git cheat sheet When things go wrong To fix a mistake Create a new branch with git and manage branches 2.4 Getting help 2.4.1 Help yourself, learn how to debug A basic solution is to print everything, but it’s usually not working well on complex problems. A convenient solution to see all the variables’ states in your code is to place some browser() from where you want to check the variables’ states. To debug functions, debugonce() is also very useful. my_log &lt;- function(x) log(x - 1) my_fun &lt;- function(a, b) { # browser() la &lt;- my_log(a) lb &lt;- my_log(b) la + lb } my_fun(1, 0) #&gt; Warning in log(x - 1): NaNs produced #&gt; [1] NaN Try to uncomment browser() or use debugonce(my_fun): debugonce(my_fun) my_fun(1, 0) Learn more with this book chapter, this other book chapter, this webinar and this RStudio article. 2.4.2 External help Can’t remember useful functions? Use cheat sheets. You can search for specific R stuff on https://rseek.org/. You should also read documentations carefully. If you’re using a package, search for vignettes and a GitHub repository. You can also use Stack Overflow. The most common use of Stack Overflow is when you have an error or a question, you google it, and most of the times the first links are Q/A on Stack Overflow. You can ask questions on Stack Overflow (using the tag r). You need to make a great R reproducible example if you want your question to be answered. Sometimes, while making this minimal reproducible example, you end up understanding and solving the issue on your own. If you are confident enough with your R skills, you can take the next step and answer questions on Stack Overflow. It’s a good way to increase your skills, or just to procrastinate while writing a scientific manuscript. You can also join communities, e.g. join the French-speaking R community or join the R-Ladies community on Slack. These are generally much friendlier and welcoming spaces compared to Stack Overflow. Useful resources Best Coding Practices for R by Grace Hopper "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
